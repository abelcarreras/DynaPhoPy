<!DOCTYPE html>
<html>

  <head>
    <script type="text/javascript"
            src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Dynaphopy : Phonon Analysis from Dynamical Data">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Dynaphopy</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <h2 id="project_tagline">Examples</h2>

        </header>
    </div>
    
    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
    	<section id="main_content" class="inner">

<a href="index.html"><div id="backbutton" s style="position:relative;right:-580px;top:-170px;width:60px"><body>Back</body></div></a>

<h3>Silicon</h3>
<p>Crystalline silicon is a well studied prototypical material that due to its simple cubic crystalline 
structure becomes very suitable as a working example.</p>

<div id="preparations_silicon"></div>  
<h5>Preparations</h5>
<p>In order to calculate the anharmonic effects fist it is necessary to define the unit cell in a VASP <strong>POSCAR</strong> type file: </p>
<pre><code> Si                                     
   1.00000000000000     
     5.4365330000000000    0.0000000000000000    0.0000000000000000
     0.0000000000000000    5.4365330000000000    0.0000000000000000
     0.0000000000000000    0.0000000000000000    5.4365330000000000
   Si
     8
Direct
  0.8750000000000000  0.8750000000000000  0.8750000000000000
  0.8750000000000000  0.3750000000000000  0.3750000000000000
  0.3750000000000000  0.8750000000000000  0.3750000000000000
  0.3750000000000000  0.3750000000000000  0.8750000000000000
  0.1250000000000000  0.1250000000000000  0.1250000000000000
  0.1250000000000000  0.6250000000000000  0.6250000000000000
  0.6250000000000000  0.1250000000000000  0.6250000000000000
  0.6250000000000000  0.6250000000000000  0.1250000000000000
</code></pre>

<p>Using <a href="http://phonopy.sourceforge.net">Phonopy</a> the harmonic forces can be calculated as detailed in phonopy <a href="http://phonopy.sourceforge.net/procedure.html">online</a> tutorial. During the calculation, a <strong>SPOSCAR</strong> file which contains a super cell of the original <strong>POSCAR</strong> file is generated. This file can be used to calculate the MD in VASP.
<br><em>Note: The super cell used in Phonopy to calculate the harmonic forces and the one used to calculate the MD in VASP can be different. Phonopy can easly generate a super cell with the desired size using the command:</em></p>

<pre><code> $ phonopy -d --dim="2 2 2" -c POSCAR_unitcell                                    
</code></pre>

<p>This generates a <strong>SPOSCAR</strong> file containing a 2x2x2 super cell of POSCAR_unitcell file.
                Alternativelly, DynaPhoPy can also be used to generate a super cell in VASP <strong>POSCAR</strong> format using the command:</p>

<pre><code> $ dynaphopy input_file --dim 2 2 2 -c_poscar SPOSCAR                                   
</code></pre>

<p><strong>input_file</strong> is a plain text file contains the information of which unitcell is used to build the super cell. This is a short example of the contains of this file (other keywords may be included):</p>

<pre><code>STRUCTURE FILE POSCAR
/home/user/Si-phonopy/POSCAR_unitcell
</code></pre>

<p>This file can also be empty, in this case DynaPhoPy will use a <strong>POSCAR</strong> named file placed in the work directory as unit cell, but <em>input_file</em> should exist.
        <br><em>Warning: You may need to update numpy if this command fails </em>
<br>VASP MD calculation is carried out using the generated super cell  and defining a regular VASP MD input like this example: </p>
  
<pre><code>      PREC = Normal                  # Precision
    IBRION = 0
      ISYM = 0                       # Disable symmetry 
     SMASS = 0                       # Define Thermostat
    MDALGO = 2                       # Nose Hoover thermostat
     POTIM = 0.7                     # Step length
     TEBEG = 800                     # Temperature
       NSW = 200000                  # Number of time steps
    NELMIN = 2                       
      NELM = 100                     
     ENCUT = 300
     EDIFF = 1.000000e-06            # Energy precision
    ISMEAR = 0
     SIGMA = 0.01
     IALGO = 38
       GGA = PS                      
     LREAL = .TRUE.
   ADDGRID = .TRUE.
     LWAVE = .FALSE.
    LCHARG = .FALSE.
</code></pre>
<p> EDIFF may have great influence in the exactitute of the results. Longer time step lenghts are recomended to increase the convergence of
phonon linewidths but to long could compromise the reliability of the simulation. 
<p>Once VASP <strong>OUTCAR</strong> and Phonopy <strong>FORCE_SETS</strong> are generated the only thing left needed to run DynaPhoPY is a DynaPhoPy input.
</p>
<pre><code>STRUCTURE FILE POSCAR
/home/user/Si-phonopy/POSCAR_unitcell

FORCE SETS
/home/user/Si-phonopy/FORCE_SETS

PRIMITIVE MATRIX
0.0 0.5 0.5
0.5 0.0 0.5
0.5 0.5 0.0

SUPERCELL MATRIX PHONOPY
2 0 0
0 2 0
0 0 2

BANDS
0.0,   0.0,   0.0         0.5,   0.0,  0.5
0.5,   0.0,   0.5         0.625  0.25  0.625
0.375, 0.375, 0.75        0.0,   0.0,  0.0
0.0,   0.0,   0.0         0.5,   0.5,  0.5
</pre></code>
<br><em>Note: there is no restriction in the input file about the number of blank lines between options. Comments are also allowed. All options are optative and can be omitted to use the default value</em></p>


<p>At this point all the information needed to run Dynaphopy is complete</p>

<h5>Calculation examples</h5>


<UL><p><LI>Plot wave vector projection power spectrum at <em>L</em> point from 0 to 16 THz (200 samples) using last 500000 time steps in XDATCAR file:</p></UL>
<pre><code>$ dynaphopy input_file XDATCAR -n 500000 -ts 0.0007 -pw -q 0.5 0.5 0.5 -r 0 16 200
</code></pre>
<img src="images/wave_silicon_800.png" alt="Interactive" style="width:630px">

<UL><p><LI>Save phonon mode projection power spectrum at <em>X</em> point (0.5 0 0.5) to spectrum.dat file using lasts 80000 times teps:</p></UL>
<pre><code>$ dynaphopy input_file OUTCAR -n 80000 -sw spectrum.dat -q 0.5 0.0 0.5
</code></pre>
</p>
<p>
<pre><code>#  frequency	     phonon1    	    phonon2		     phonon3
    0.0000	1.6287598014e-01	1.2511061132e-01	3.4403852187e-03	2.3601374123e-03	2.8351033106e-03	2.4230063427e-03	
    0.0025	1.6287848353e-01	1.2511254847e-01	3.4404392354e-03	2.3601725698e-03	2.8351431247e-03	2.4230438285e-03	
    0.0050	1.6288599372e-01	1.2511834502e-01	3.4406010527e-03	2.3602771107e-03	2.8352621011e-03	2.4231555872e-03	
    0.0075	1.6289848089e-01	1.2512798607e-01	3.4408711363e-03	2.3604519665e-03	2.8354602400e-03	2.4233420845e-03	
    0.0100	1.6291600466e-01	1.2514150143e-01	3.4412494861e-03	2.3606969044e-03	2.8357380070e-03	2.4236030877e-03	
    0.0125	1.6293852031e-01	1.2515886128e-01	3.4417354036e-03	2.3610112257e-03	2.8360949364e-03	2.4239385966e-03	
    .....	................	................	................	................	2.8365314938e-03	2.4243488442e-03	
</code></pre>


<UL><p><LI>Peak analysis at <em>&Gamma;</em> point using MEM method (parallel) with 1000 coeficients:</p></UL>
<pre><code>$ dynaphopy input_file OUTCAR -n 5000000 -pa -psm 4 -cf 1000
</code></pre>
<p></p>

<pre><code>Peak # 4
----------------------------------------------
Width                             0.336054 THz
Position                         14.591885 THz
Area (&lt;K>)    (Lorentzian)        0.030740 eV
Area (&lt;K>)    (Total)             0.033473 eV
&lt;|dQ/dt|^2>                       0.061479 eV
Occupation number                 5.901073
Fit temperature                 711.985996 K
Base line                         0.000072 eV * ps
Maximum height                    0.058233 eV * ps
Fitting global error              0.014987
Frequency shift                  -0.544369 THz

Peak # 5
----------------------------------------------
Width                             0.336054 THz
Position                         14.591885 THz
Area (&lt;K>)    (Lorentzian)        0.030740 eV
Area (&lt;K>)    (Total)             0.033473 eV
&lt;|dQ/dt|^2>                       0.061479 eV
Occupation number                 5.901073
Fit temperature                 711.985996 K
Base line                         0.000072 eV * ps
Maximum height                    0.058233 eV * ps
Fitting global error              0.014987
Frequency shift                  -0.544369 THz

Peak # 6
----------------------------------------------
Width                             0.336054 THz
Position                         14.591885 THz
Area (&lt;K>)    (Lorentzian)        0.030740 eV
Area (&lt;K>)    (Total)             0.033473 eV
&lt;|dQ/dt|^2>                       0.061479 eV
Occupation number                 5.901073
Fit temperature                 711.985996 K
Base line                         0.000072 eV * ps
Maximum height                    0.058233 eV * ps
Fitting global error              0.014987
Frequency shift                  -0.544369 THz
</code></pre>
<img src="images/analisis_si_4.png" alt="Interactive" style="width:630px">
<img src="images/analisis_si_5.png" alt="Interactive" style="width:630px">
<img src="images/analisis_si_6.png" alt="Interactive" style="width:630px">


<UL><p><LI>Load interactive interface from hdf5 file:</p></UL>
<pre><code>$ dynaphopy input_file -lv velocity_800.h5 -n 50000 -i
</code></pre>

<UL><p><LI>Harmonic eigenvectors representation</p></UL>
<img src="images/phonon_silicon_g4.png" alt="Interactive" style="width:630px">

<UL><p><LI>Boltzmann analysis</p></UL>
<pre><code>Maxwell-Boltzmann distribution analysis
----------------------------------------------
Average: 4.0741982e+01 Angstrom/ps
Deviation: 1.7195930e+01 Angstrom/ps
Distribution parameter: 2.5531721e+01 Angstrom/ps
Temperature fit: 788.818186 K
</code></pre>
<img src="images/Boltzmann_silicon.png" alt="Interactive" style="width:630px">

<UL><p><LI>Renormalized phonon bands</p></UL>

<img src="images/silicon_bands.png" alt="Interactive" style="width:630px">

</UL>

<h5>LAMMPS calculations</h5>
LAMMPS input preparation can be a little tricky, since is not possible to automatically generate 
the simulations cell using create_atoms command. In order to keep consistency with Phonopy calculation 
and DynaPhoPy the cell has to be defined manually to preserve the same order of atoms. To do this, 
it is convenient to prepare a separated structure file and read it in the LAMMPS input file.
</p>
Structure file  (data.si):
<pre><code>Start File for LAMMPS

 64 atoms

 1 atom types

 0  10.9323 xlo xhi
 0  10.9323 ylo yhi
 0  10.9323 zlo zhi
 0  0  0  xy xz yz

 Masses

 1  28.085

 Atoms

 1 1 4.78289 4.78289 4.78289
 2 1 10.2491 4.78289 4.78289
 3 1 4.78289 10.2491 4.78289
 4 1 10.2491 10.2491 4.78289
 5 1 4.78289 4.78289 10.2491
 6 1 10.2491 4.78289 10.2491
 7 1 4.78289 10.2491 10.2491
 8 1 10.2491 10.2491 10.2491
 9 1 4.78289 2.04981 2.04981
 10 1 10.2491 2.04981 2.04981
 11 1 4.78289 7.51598 2.04981
 12 1 10.2491 7.51598 2.04981
 13 1 4.78289 2.04981 7.51598
 14 1 10.2491 2.04981 7.51598
 15 1 4.78289 7.51598 7.51598
 16 1 10.2491 7.51598 7.51598
 17 1 2.04981 4.78289 2.04981
 18 1 7.51598 4.78289 2.04981
 19 1 2.04981 10.2491 2.04981
 20 1 7.51598 10.2491 2.04981
 21 1 2.04981 4.78289 7.51598
 22 1 7.51598 4.78289 7.51598
 .. . ....... ....... .......
</code></pre>
<p>This file can contain information about the atoms coordinates, simulations cell size and
atoms masses. DynaPhoPy can be used to generate this file by using <strong>-c_lammps</strong> flag.</p>

<pre><code> $ dynaphopy input_file --dim 2 2 2 -c_lammps data.si                                    
</code></pre>

<p><em>Note: This information can be also specified in LAMMPS input, but keeping it together
in a structure file facilitates the reusability of inputs.
</em></p>

<p>Lammps input file constains all the parameters regarding to the MD simulation. All atom types defined in <em>data file</em> should be assigned to a potential. This is an example:</p>

LAMMPS input file:
<pre><code>units           metal                       #Use this units for DynaPhoPy
atom_style      atomic

boundary        p p p                       #Periodical conditions

read_data       data.si                     #Structure file

pair_style      tersoff
pair_coeff      * * SiCGe.tersoff Si(C)     #Empirical potential

variable        t equal 800                 #Define the temperature

neighbor        0.3 bin
neigh_modify    delay 0

timestep        0.001                       #Define time step

thermo_style    custom step etotal temp vol press
thermo          10000

velocity        all create $t 3627941 dist gaussian mom yes
velocity        all scale $t

fix             int all nvt temp $t $t 0.5  #Canonical ensemble

dump            dynaphopy all custom 1 trajectory.lammpstrj x y z
dump_modify     dynaphopy sort id
dump_modify     dynaphopy format "%16.10f %16.10f %16.10f"

run             1000000                      #Number of timesteps
</code></pre>
<br><em>Note: The number of timesteps printed in the trajectory file is not necessarily 
the number specified in <strong>run command</strong>, it will also depend on the format used in
<strong>dump command</strong>. For further details refere to 
<a href="http://lammps.sandia.gov/doc/dump.html">LAMMPS manual</a>.</em></p>
<p>
The use of LAMMPS trajectory file is equivalent to VASP output OUTCAR file. DynaPhoPy will automatically recognize 
the file type. If needed, time step should be specified by flag <strong>-ts</strong>.

<pre><code>$ dynaphopy input_file trajectory.lammpstrj -n 500000 -ts 0.001
</code></pre>

</p>

    </section>
    </div>
    
    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Dynaphopy maintained by <a href="https://github.com/abelcarreras">abelcarreras</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>
    
  </body>
</html>

