<!DOCTYPE html>
<html>

  <head>
    <script type="text/javascript"
            src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Dynaphopy : Phonon Analysis from Dynamical Data">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Dynaphopy</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <h2 id="project_tagline">How to use</h2>

        </header>
    </div>
    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
    	<section id="main_content" class="inner">

<a href="index.html"><div id="backbutton" s style="position:relative;right:-580px;top:-170px;width:60px"><body>Back</body></div></a>

<h3>Obtain input data</h3>
<UL>
<LI><h5>Prepare Phonopy harmonic lattice dynamics calculation</h5>
<p> Dynaphopy interface with phonopy and needs <strong>FORCE_SETS</strong> file created by it to work properly. 
<br> This file contains the information about atomic forces and it is required in order to calculate the harmonic phonon modes.
You can follow the instruction in phonopy <a href="http://phonopy.sourceforge.net/procedure.html">tutorial</a> to obtain it.
<br><em>Keep original <strong>POSCAR</strong> file used in the calculation containing the unaltered unit cell (VASP 5.x style prefered)</em></p>

<LI><h5>Prepare Molecular Dynamics calculation</h5>
<p> At the present time DynaPhoPy can read MD trajectories from VASP and LAMMPS.

<br><strong>- Using VASP</strong>
<br>VASP is a  popular software to perform first principles calculations of solids.
Obtain an <strong>OUTCAR</strong> output file containing a MD calculation from VASP. This file han be read directly by DynaPhoPy.
<br>Please, refere to VASP <a href="http://cms.mpi.univie.ac.at/vasp/vasp/vasp.html"> online manual</a> for detailed information to how to calculate a MD simulation.

<br><strong>- Using LAMMPS</strong>
<br>LAMMPS is a extremely flexible software that allows to calculate Molecular dynamics of a large variety of systems using empirical potentials.
LAMMPS outputs may vary depending on the output style you use. DyanPhoPy only can read lammpstrj outputs using the following output style:
</p><pre><code>dump         dynaphopy all custom 1 output_file_name.lammpstrj x y z
dump_modify  dynaphopy sort id
</code></pre>
<br>Please, refere to LAMMPS <a href="http://lammps.sandia.gov/doc/Manual.html"> online manual</a> for usage and detailed information about output <a href="http://lammps.sandia.gov/doc/dump.html"> formats and styles</a>.
<br> LAMMPS trajectories do not have information about the time step used in the MD. For this reason the time step has to be introduced manually to DynaPhoPy in order to scale the time correctly. For this purpose <strong>-ts</strong>
flag is used. This flag accepts a float number that indicated the time step in picoseconds.
</p><pre><code>$ dynaphopy input_file trajectory_file -ts 0.002 
</code></pre>
<br>This flag only work in LAMMPS trajectories, for VASP trajectories it is ignored. 
Reading LAMMPS file, if not specified 0.001 ps time step is used.
Take in account that LAMMPS can write data at different intervals (not necessarily every step). This is taken in account in DynaPhoPy. <strong>-ts</strong>
should contain the time steps specified in <a href="http://lammps.sandia.gov/doc/timestep.html">timestep command</a>.

<p>
<br><strong>Important:</strong><em> The supercell used to calculate the MD has to be an integer multiple of the cell used in phonopy calculation.
The order of the atoms within the cell has to be kept in both cells to work properly. <strong>A convenient way is to use Phonopy to <a href="http://phonopy.sourceforge.net/procedure.html">generate</a> the supercell (SPOSCAR) to be used in the MD</strong></em>. 
</p>

</p><pre><code>$ phonopy -d --dim="2 2 2"</code></pre>


</UL>
<h3>Dynaphopy input file</h3>
<p>To run Dynaphopy needs an input file. The input file is an plain text that contains basic information about files location, estructural data and other parameters that Dynaphopy may requiere to work.
<br> All these parameters are optional, in case of not beeing explicitly especificated dynaphopy will use default ones.
<br> Each parameter is preceded by a label which indicates the kind of parameter it is. Altering this label may prevent the parameters to be recognized correctly, be carefull. The order of the parameters inside input file is not important, neither the blank lines used between them. The only requisite is to not leave any blank line between labels and parameters. Comments can be added to the input file while not interfearing with the parameters labels. To avoid future inconvenients it is recomended to start each comment line with some special character.</p>

<UL><LI><h5>POSCAR and FORCE_SETS files location</h5>
<p>Define the file name and path in which a POSCAR type file containing the crystal unit cell in <strong>fractional coordinates</strong> and FORCE_SETS containing atom forces files are stored. 
If not specified POSCAR and FORCE_SETS filen ames stored in the working directory are taken as default.</p>

<pre><code>STRUCTURE FILE POSCAR
/home/user/phonopy/calculation/POSCAR_unitcell
</code></pre>
<p></p>
<pre><code>FORCE CONSTANTS
/home/user/phonopy/calculation/FORCE_SETS
</code></pre>
<p>Alternatively to POSCAR file, an OUTCAR file can be used to read the cell estructure<p>
<pre><code>STRUCTURE FILE OUTCAR
/home/user/phonopy/calculation/OUTCAR_unitcell
</code></pre>

<LI><h5>Primitive matrix definition</h5>
<p>This matrix defines the primitive cell size respect to the unit cell. If not defined it takes identity matrix meaning that primitive cell and unit cell are the same.
</p><pre><code>PRIMITIVE MATRIX
0.0 0.5 0.5
0.5 0.0 0.5
0.5 0.5 0.0
</code></pre>

<LI><h5>Supercell matrix used in lattice dynamics calculation</h5>
<p>In order to interface correctly with Phonopy, Dynaphopy needs to know the size of the supercell used to calculate the forces in Phonopy. 
This is specified with  <strong>--dim</strong> flag in Phonopy. For further information, please check Phonopy online<a href="http://phonopy.sourceforge.net/procedure.html"> tutorial</a> .
<br>This matrix is integer and diagonal. If not especified, by default it takes identity matrix.
</p><pre><code>SUPERCELL MATRIX PHONOPY
4 0 0
0 3 0
0 0 3
</code></pre>

<LI><h5>Phonon dispersion bands</h5>
<p>Interfacing with Phonopy, Dynaphopy can obtain the phonon dispersion diagram. This parameter defines the path in the reciprocal space used to calculate the bands. This path is defined small linear segments. Each segment is written in a diferent input line. The first 3 values indicate the origin point in reduced coordinates while tha last 3 indicate the destination. There is no limit for the number of segments used to define the 
path. 
<br><em>This feature is a simple interface to phonopy and is mean to be used as reference only. For additional features please use <a href="http://phonopy.sourceforge.net/">phonopy</a> directly.</em>
</p><pre><code>BANDS
0.0,   0.0,   0.0         0.5,   0.0,  0.5
0.5,   0.0,   0.5         0.625  0.25  0.625
0.375, 0.375, 0.75        0.0,   0.0,  0.0
0.0,   0.0,   0.0         0.5,   0.5,  0.5
</code></pre>

</UL>

<h3>Execute Dynaphopy</h3>
<p>Phonopy can be used in two different ways: from command line or using interactive user interface.
Interactive interface is the most simple way to work with dynaphopy, however command line flag interface 
has more options and becomes very usefull to calculate in batch. Some options that are not directly editables in interactive interface 
can be set when loading dynaphopy using additional flags.
<UL><LI><h5>Command line interface</h5>
<p>To run Dynaphopy only is nedeed to call dynaphopy script (places in script folder) with Dynaphonpy input file and trajectory file file as arguments. 
Input file defines where the FORCE_SETS and POSCAR are and OUTCAR/LAMMPStrj file contain the MD trajectory.</p>
</p><pre><code>$ dynaphopy input_file OUTCAR				(VASP)
$ dynaphopy input_file LAMMPS.lammpstrj -ts 0.002	(LAMMPS)
</code></pre>
<p>This command does essentially nothing, since no calculation has been requested. It just checks that all the necessary files exists and can be loaded correctly.
<br>To request a calculation, additional flags have to be set. Using <strong>-h</strong> flag shows all available options.</p>
</p><pre><code>$ dynaphopy -h
positional arguments:
  data_file             input file containing structure related data
  TRAJECTORY            Output file containing MD trajectory


optional arguments:
  -h, --help            show this help message and exit
  -lv file, --load_velocity file
                        load velocity from hdf5 file
  -i, --interactive     enter interactive mode
  -q N N N              wave vector used to calculate projections (default: 0
                        0 0)
  -r N N N, --frequency_range N N N
                        frequency range for correlation function calculation
                        (min, max, number of points)
  -n N                  number of MD last steps to take (default: All)
  -ts step, --time_step step
                        time step in ps (default: 0 [Read from trajectory
                        file])
  -pd, --plot_direct    plot full power spectrum
  -pw, --plot_wave_vector
                        plot projection into wave vector
  -pp, --plot_phonon_mode
                        plot projection into phonon modes
  -sd file, --save_direct file
                        save full power spectrum to file
  -sw file, --save_wave_vector file
                        save projection into wave vector to file
  -sp file, --save_phonon_mode file
                        save projection into phonon modes to file
  -sv file, --save_velocity file
                        save velocity into hdf5 file
  -svc file, --save_vc file
                        save wave vector projected velocity into hdf5 file
  -psm N, --power_spectrum_algorithm N
                        select power spectrum calculation algorithm (default
                        4)
  -cf N, --number_of_mem_coefficients N
                        number of coefficients to use in MEM algorithm
                        (default 300)
  -csa, --coefficient_scan_analysis
                        request coefficient scan analysis
  -pa, --peak_analysis  request a peak analysis
  --silent              executes without showing plots
  --velocity_only       loads only velocity data from hdf5 file
  -pad N N N, --plot_atomic_displacements N N N
                        plot atomic displacements respect to specified
                        direction [N N N]
  -sad X X X X, --save_atomic_displacements X X X X
                        save atomic displacements into a file [ N N N filename
                        ]
  --read_from N         define interval of trajectory to read (default: 1)
  --read_to N           define interval of trajectory to read (default: end)
  -ds, --display_spectrum
                        display phonon dispersion spectrum data in screen
                        (just for test: not recommended)
  -sfc file, --save_force_constants file
                        save the renormalized force constants to a file
</code></pre>


<LI><h5>Interactive interface</h5>
<p>Interactive interface is the easiest way to run Dynaphopy. The interface show a menu screen which can be used to navigate through the different
options. To start interactive interaface  <strong><nobr>-i</nobr></strong> flag has to be added. Additional flags may be used to set different initial parameters but direct calculations requests (such as power spectra calculations) are not recomended.</p>
</p><pre><code>$ dynaphopy input_file OUTCAR -i 
</code></pre>
<img src="images/dynaphopy_inter.png" alt="Interactive" style="width:605px">
</UL>
Interactive interface can be used to check preliminary results in and easy way. 
Interactive interface is mean to be used to visualize information, so xwindows should be
available for most of the features. To store the data in files command line should be used.
</p>
<p><br><strong>List of exclusive features in interactive interface</strong>
<br> Velocity distribution analysis (Boltzmann analysis)
<br> Harmonic eigenvectors representation
<br> Harmonic phonon dispersion bands
<br> Renormalized phonon dispersion bands




    </section>
    </div>
    
    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Dynaphopy maintained by <a href="https://github.com/abelcarreras">abelcarreras</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>
    
  </body>
</html>